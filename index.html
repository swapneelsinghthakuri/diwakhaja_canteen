<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Canteen & Mess Management System</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1>Swapneel School Canteen Management System</h1>
            <p class="subtitle">Hybrid Module: Diwa Khaja + Commercial Canteen + Mess Management</p>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <button class="nav-btn active" onclick="showSection('dashboard')">üìä Dashboard</button>
            <button class="nav-btn" onclick="showSection('setup')">‚öôÔ∏è Setup</button>
            <button class="nav-btn" onclick="showSection('diwa-khaja')">üç± Diwa Khaja (Free)</button>
            <button class="nav-btn" onclick="showSection('canteen')">üí∞ Canteen Sale (Paid)</button>
            <button class="nav-btn" onclick="showSection('qr-canteen')"> QR Canteen</button>
            <button class="nav-btn" onclick="showSection('mess')"> Mess</button>
            <button class="nav-btn" onclick="showSection('reports')"> Reports</button>
        </div>
    </nav>

    <!-- Success Notification (floating) -->
    <div id="successNotification" style="display:none; position:fixed; top:80px; right:20px; background:#48bb78; color:white; padding:15px 25px; border-radius:8px; z-index:9999; box-shadow:0 4px 12px rgba(0,0,0,0.15); font-weight:500;"></div>

    <!-- Main Content -->
    <main class="container">
        
        <!-- DASHBOARD SECTION -->
        <section id="dashboard" class="section active">
            <h2>Dashboard Overview</h2>
            <div class="dashboard-grid">
                <div class="stat-card blue">
                    <h3>Today's Diwa Khaja</h3>
                    <div class="stat-number" id="todayDiwaCount">0</div>
                    <p>Students Served (Free)</p>
                </div>
                <div class="stat-card green">
                    <h3>Today's Canteen Sales</h3>
                    <div class="stat-number" id="todaySales">Rs0</div>
                    <p>Total Revenue</p>
                </div>
                <div class="stat-card orange">
                    <h3>Food Items</h3>
                    <div class="stat-number" id="totalItems">0</div>
                    <p>Active Items</p>
                </div>
                <div class="stat-card red">
                    <h3>Low Stock Alert</h3>
                    <div class="stat-number" id="lowStock">0</div>
                    <p>Items Below 10</p>
                </div>
            </div>

            <div class="quick-actions">
                <h3>Quick Actions</h3>
                <div class="action-buttons">
                    <button class="action-btn" onclick="showSection('diwa-khaja'); showSubSection('distribution')">üìù Diwa Khaja Distribution</button>
                    <button class="action-btn" onclick="showSection('canteen'); showSubSection('pos')">üõí New Canteen Sale</button>
                    <button class="action-btn" onclick="showSection('qr-canteen'); showSubSection('qr-pos')">üì± QR Quick Sale</button>
                    <button class="action-btn" onclick="showSection('mess'); showSubSection('mess-student-entry')">üçΩÔ∏è Mess Entry</button>
                    <button class="action-btn" onclick="showSection('setup'); showSubSection('food-item')">‚ûï Add Food Item</button>
                    <button class="action-btn" onclick="showSection('reports')">üìä View Reports</button>
                </div>
            </div>
        </section>

        <!-- SETUP SECTION -->
        <section id="setup" class="section">
            <h2>‚öôÔ∏è Setup & Masters</h2>
            <p class="section-desc">Create and manage master data (one-time setup)</p>
            
            <div class="setup-tabs">
                <button class="tab-btn active" onclick="showSubSection('canteen-master')">Canteen</button>
                <button class="tab-btn" onclick="showSubSection('food-category')">Food Category</button>
                <button class="tab-btn" onclick="showSubSection('food-item')">Food Items</button>
                <button class="tab-btn" onclick="showSubSection('time-slot')">Time Slots</button>
                <button class="tab-btn" onclick="showSubSection('student-master')">Students</button>
            </div>

            <!-- Canteen Master -->
            <div id="canteen-master" class="sub-section active">
                <h3>1. Canteen Master</h3>
                <div class="form-card">
                    <form id="canteenForm">
                        <div class="form-group">
                            <label>Canteen Name *</label>
                            <input type="text" id="canteenName" required placeholder="e.g., Main School Canteen">
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="canteenDesc" rows="2" placeholder="Brief description of canteen"></textarea>
                        </div>
                        <button type="submit" class="btn-primary">Save Canteen</button>
                    </form>
                </div>
                <div class="data-table">
                    <h4>Existing Canteens</h4>
                    <table id="canteenTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Canteen Name</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Food Category -->
            <div id="food-category" class="sub-section">
                <h3>2. Food Category</h3>
                <div class="form-card">
                    <form id="categoryForm">
                        <div class="form-group">
                            <label>Category Name *</label>
                            <input type="text" id="categoryName" required placeholder="e.g., Breakfast, Snacks, Drinks">
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="categoryDesc" rows="2" placeholder="Category description"></textarea>
                        </div>
                        <button type="submit" class="btn-primary">Save Category</button>
                    </form>
                </div>
                <div class="data-table">
                    <h4>Existing Categories</h4>
                    <table id="categoryTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Category Name</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Food Items -->
            <div id="food-item" class="sub-section">
                <h3>3. Food Items</h3>
                <div class="form-card">
                    <form id="foodItemForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Food Category *</label>
                                <select id="foodCategory" required>
                                    <option value="">Select Category</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Food Name *</label>
                                <input type="text" id="foodName" required placeholder="e.g., Samosa, Tea">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Unit / Volume *</label>
                                <select id="foodUnit" required>
                                    <option value="">Select Unit</option>
                                    <option value="pcs">Pieces (pcs)</option>
                                    <option value="plate">Plate</option>
                                    <option value="glass">Glass</option>
                                    <option value="cup">Cup</option>
                                    <option value="bowl">Bowl</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Selling Price (Rs) *</label>
                                <input type="number" id="foodPrice" required min="0" step="0.01" placeholder="0.00">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="foodDesc" rows="2" placeholder="Food item description"></textarea>
                        </div>
                        <button type="submit" class="btn-primary">Save Food Item</button>
                    </form>
                </div>
                <div class="data-table">
                    <h4>Existing Food Items</h4>
                    <table id="foodItemTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Category</th>
                                <th>Food Name</th>
                                <th>Unit</th>
                                <th>Price (Rs)</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Time Slot -->
            <div id="time-slot" class="sub-section">
                <h3>4. Time Slot Master</h3>
                <div class="form-card">
                    <form id="timeSlotForm">
                        <div class="form-group">
                            <label>Time Slot Name *</label>
                            <input type="text" id="slotName" required placeholder="e.g., Morning, Tiffin, Lunch">
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="slotDesc" rows="2" placeholder="Time slot description"></textarea>
                        </div>
                        <button type="submit" class="btn-primary">Save Time Slot</button>
                    </form>
                </div>
                <div class="data-table">
                    <h4>Existing Time Slots</h4>
                    <table id="timeSlotTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Time Slot</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Student Master (NEW) -->
            <div id="student-master" class="sub-section">
                <h3>5. Student Master (for QR System)</h3>
                <div class="form-card">
                    <form id="studentForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Student ID *</label>
                                <input type="text" id="studentId" required placeholder="e.g., STU001">
                            </div>
                            <div class="form-group">
                                <label>Student Name *</label>
                                <input type="text" id="studentName" required placeholder="e.g., Rahul Kumar">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Class *</label>
                                <select id="studentClass" required>
                                    <option value="">Select Class</option>
                                    <option value="Class 1">Class 1</option>
                                    <option value="Class 2">Class 2</option>
                                    <option value="Class 3">Class 3</option>
                                    <option value="Class 4">Class 4</option>
                                    <option value="Class 5">Class 5</option>
                                    <option value="Class 6">Class 6</option>
                                    <option value="Class 7">Class 7</option>
                                    <option value="Class 8">Class 8</option>
                                    <option value="Class 9">Class 9</option>
                                    <option value="Class 10">Class 10</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Daily Limit (Rs) *</label>
                                <input type="number" id="studentDailyLimit" required min="0" value="100">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Initial Wallet Balance (Rs)</label>
                                <input type="number" id="studentWallet" min="0" value="0" step="0.01">
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">Save Student</button>
                    </form>
                </div>
                <div class="data-table">
                    <h4>Existing Students</h4>
                    <table id="studentTable">
                        <thead>
                            <tr>
                                <th>Student ID</th>
                                <th>Name</th>
                                <th>Class</th>
                                <th>Wallet Balance</th>
                                <th>Daily Limit</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- DIWA KHAJA SECTION -->
        <section id="diwa-khaja" class="section">
            <h2>üç± Diwa Khaja (Free Food Distribution)</h2>
            <p class="section-desc">Government-funded free food program</p>
            
            <div class="setup-tabs">
                <button class="tab-btn active" onclick="showSubSection('menu-setup')">Menu Setup</button>
                <button class="tab-btn" onclick="showSubSection('distribution')">Distribution</button>
                <button class="tab-btn" onclick="showSubSection('diwa-reports')">Reports</button>
            </div>

            <!-- Menu Setup -->
            <div id="menu-setup" class="sub-section active">
                <h3>5. Diwa Khaja Menu Setup</h3>
                <div class="form-card">
                    <form id="diwaMenuForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Class *</label>
                                <select id="diwaClass" required>
                                    <option value="">Select Class</option>
                                    <option value="Class 1">Class 1</option>
                                    <option value="Class 2">Class 2</option>
                                    <option value="Class 3">Class 3</option>
                                    <option value="Class 4">Class 4</option>
                                    <option value="Class 5">Class 5</option>
                                    <option value="Class 6">Class 6</option>
                                    <option value="Class 7">Class 7</option>
                                    <option value="Class 8">Class 8</option>
                                    <option value="Class 9">Class 9</option>
                                    <option value="Class 10">Class 10</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Time Slot *</label>
                                <select id="diwaTimeSlot" required>
                                    <option value="">Select Time Slot</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Food Item *</label>
                                <select id="diwaFoodItem" required>
                                    <option value="">Select Food Item</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Quantity per Student *</label>
                                <input type="number" id="diwaQuantity" required min="1" value="1">
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">Save Menu</button>
                    </form>
                </div>
                <div class="data-table">
                    <h4>Configured Menus</h4>
                    <table id="diwaMenuTable">
                        <thead>
                            <tr>
                                <th>Class</th>
                                <th>Time Slot</th>
                                <th>Food Item</th>
                                <th>Quantity</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Distribution -->
            <div id="distribution" class="sub-section">
                <h3>6. Diwa Khaja Distribution</h3>
                <div class="form-card">
                    <form id="distributionForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Date *</label>
                                <input type="date" id="distDate" required>
                            </div>
                            <div class="form-group">
                                <label>Class *</label>
                                <select id="distClass" required>
                                    <option value="">Select Class</option>
                                    <option value="Class 1">Class 1</option>
                                    <option value="Class 2">Class 2</option>
                                    <option value="Class 3">Class 3</option>
                                    <option value="Class 4">Class 4</option>
                                    <option value="Class 5">Class 5</option>
                                    <option value="Class 6">Class 6</option>
                                    <option value="Class 7">Class 7</option>
                                    <option value="Class 8">Class 8</option>
                                    <option value="Class 9">Class 9</option>
                                    <option value="Class 10">Class 10</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Time Slot *</label>
                                <select id="distTimeSlot" required>
                                    <option value="">Select Time Slot</option>
                                </select>
                            </div>
                        </div>
                        <button type="button" class="btn-primary" onclick="loadStudentsForDistribution()">Load Students</button>
                    </form>
                </div>
                <div class="data-table" id="distributionTableDiv" style="display:none;">
                    <h4>Mark Distribution</h4>
                    <table id="distributionTable">
                        <thead>
                            <tr>
                                <th>Student ID</th>
                                <th>Student Name</th>
                                <th>Food Item</th>
                                <th>Quantity</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <button type="button" class="btn-success" onclick="saveDistribution()">Save Distribution</button>
                </div>
            </div>

            <!-- Diwa Reports -->
            <div id="diwa-reports" class="sub-section">
                <h3>7. Diwa Khaja Reports</h3>
                <div class="report-filters">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Report Type</label>
                            <select id="diwaReportType">
                                <option value="daily">Daily Distribution</option>
                                <option value="class">Class-wise</option>
                                <option value="student">Student-wise</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" id="diwaReportDate">
                        </div>
                        <div class="form-group">
                            <label>Class (Optional)</label>
                            <select id="diwaReportClass">
                                <option value="">All Classes</option>
                                <option value="Class 1">Class 1</option>
                                <option value="Class 2">Class 2</option>
                                <option value="Class 3">Class 3</option>
                                <option value="Class 4">Class 4</option>
                                <option value="Class 5">Class 5</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button type="button" class="btn-primary" onclick="generateDiwaReport()">Generate Report</button>
                        </div>
                    </div>
                </div>
                <div class="data-table" id="diwaReportDiv">
                    <h4>Report Results</h4>
                    <div id="diwaReportContent"></div>
                </div>
            </div>
        </section>

        <!-- CANTEEN SECTION -->
        <section id="canteen" class="section">
            <h2>üí∞ Canteen Sale (Paid)</h2>
            <p class="section-desc">Commercial canteen billing and sales</p>
            
            <div class="setup-tabs">
                <button class="tab-btn active" onclick="showSubSection('pos')">POS / Billing</button>
                <button class="tab-btn" onclick="showSubSection('sales-reports')">Sales Reports</button>
            </div>

            <!-- POS / Billing -->
            <div id="pos" class="sub-section active">
                <h3>8. Canteen Sale / Billing (POS)</h3>
                <div class="pos-container">
                    <div class="pos-left">
                        <form id="posForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date *</label>
                                    <input type="date" id="posDate" required>
                                </div>
                                <div class="form-group">
                                    <label>Time Slot *</label>
                                    <select id="posTimeSlot" required>
                                        <option value="">Select Time Slot</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Customer Type *</label>
                                <select id="posCustomerType" required>
                                    <option value="">Select Customer Type</option>
                                    <option value="Student">Student</option>
                                    <option value="Teacher">Teacher</option>
                                    <option value="Staff">Staff</option>
                                    <option value="Walk-in">Walk-in</option>
                                </select>
                            </div>
                            <hr>
                            <h4>Add Items</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Food Item *</label>
                                    <select id="posItem">
                                        <option value="">Select Item</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Quantity *</label>
                                    <input type="number" id="posQuantity" min="1" value="1">
                                </div>
                                <div class="form-group">
                                    <button type="button" class="btn-secondary" onclick="addItemToCart()">Add to Cart</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="pos-right">
                        <div class="cart-card">
                            <h4>Cart Items</h4>
                            <table id="cartTable">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Qty</th>
                                        <th>Rate</th>
                                        <th>Amount</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                            <div class="cart-total">
                                <h3>Total: Rs<span id="cartTotal">0.00</span></h3>
                            </div>
                            <div class="form-group">
                                <label>Payment Mode</label>
                                <select id="posPaymentMode">
                                    <option value="Cash">Cash</option>
                                </select>
                            </div>
                            <button type="button" class="btn-success btn-large" onclick="completeSale()">Complete Sale</button>
                            <button type="button" class="btn-danger" onclick="clearCart()">Clear Cart</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sales Reports -->
            <div id="sales-reports" class="sub-section">
                <h3>9. Sales Reports</h3>
                <div class="report-filters">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Report Type</label>
                            <select id="salesReportType">
                                <option value="daily">Daily Sales</option>
                                <option value="item">Item-wise Sales</option>
                                <option value="timeslot">Time Slot-wise Sales</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" id="salesReportDate">
                        </div>
                        <div class="form-group">
                            <button type="button" class="btn-primary" onclick="generateSalesReport()">Generate Report</button>
                        </div>
                    </div>
                </div>
                <div class="data-table" id="salesReportDiv">
                    <h4>Report Results</h4>
                    <div id="salesReportContent"></div>
                </div>
            </div>
        </section>

        <!-- QR CANTEEN SECTION -->
        <section id="qr-canteen" class="section">
            <h2>üì± QR-Based Canteen (Express Mode)</h2>
            <p class="section-desc">Fast QR-based wallet sales for students</p>
            
            <div class="setup-tabs">
                <button class="tab-btn active" onclick="showSubSection('qr-pos')">QR POS</button>
                <button class="tab-btn" onclick="showSubSection('wallet-recharge')">Wallet Recharge</button>
                <button class="tab-btn" onclick="showSubSection('qr-reports')">QR Reports</button>
                <button class="tab-btn" onclick="showSubSection('parent-view')">Parent View</button>
            </div>

            <!-- QR POS -->
            <div id="qr-pos" class="sub-section active">
                <h3>QR Quick Sale</h3>
                
                <!-- Counter Selection -->
                <div class="form-card">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Current Counter:</label>
                            <select id="counterSelector" onchange="setCounterId(this.value)">
                                <option value="C1">Counter 1</option>
                                <option value="C2">Counter 2</option>
                                <option value="C3">Counter 3</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Offline Queue:</label>
                            <strong id="offlineQueueCount">0</strong> pending
                        </div>
                    </div>
                </div>

                <!-- QR Scanner Input -->
                <div class="form-card">
                    <h4>Scan Student QR Code</h4>
                    <input type="text" id="qrInput" placeholder="Scan QR or enter Student ID" 
                           style="font-size:20px; padding:15px; width:100%; border:2px solid #667eea; border-radius:8px;"
                           autofocus>
                    <p style="margin-top:10px; color:#718096; font-size:14px;">
                        <strong>Test IDs:</strong> STU001, STU002, STU003, STU004, STU005
                    </p>
                </div>

                <!-- QR Student Panel (Hidden by default) -->
                <div id="qrStudentPanel" style="display: none;" class="form-card">
                    <h4>Scanned Student</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Student ID:</label>
                            <strong id="qrStudentId" style="font-size:18px;">---</strong>
                        </div>
                        <div class="form-group">
                            <label>Name:</label>
                            <strong id="qrStudentName" style="font-size:18px;">---</strong>
                        </div>
                        <div class="form-group">
                            <label>Class:</label>
                            <strong id="qrStudentClass" style="font-size:18px;">---</strong>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Wallet Balance:</label>
                            <h3 id="qrStudentBalance" style="color:#48bb78;">Rs0.00</h3>
                        </div>
                        <div class="form-group">
                            <label>Today's Expense:</label>
                            <strong id="qrTodayExpense" style="font-size:16px;">Rs0.00</strong>
                        </div>
                        <div class="form-group">
                            <label>Remaining Limit:</label>
                            <strong id="qrRemainingLimit" style="font-size:16px;">Rs0.00</strong>
                        </div>
                    </div>
                    
                    <!-- Quick Sale Buttons -->
                    <h4 style="margin-top:20px;">Quick Sale (One-Tap)</h4>
                    <div class="action-buttons" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));">
                        <button class="quick-sale-btn btn-success" onclick="quickSale(1)" disabled>Idli Rs20</button>
                        <button class="quick-sale-btn btn-success" onclick="quickSale(2)" disabled>Poha Rs15</button>
                        <button class="quick-sale-btn btn-success" onclick="quickSale(3)" disabled>Samosa Rs10</button>
                        <button class="quick-sale-btn btn-success" onclick="quickSale(4)" disabled>Vada Pav Rs15</button>
                        <button class="quick-sale-btn btn-success" onclick="quickSale(5)" disabled>Tea Rs10</button>
                        <button class="quick-sale-btn btn-success" onclick="quickSale(6)" disabled>Cold Drink Rs15</button>
                        <button class="quick-sale-btn btn-success" onclick="quickSale(7)" disabled>Rice Plate Rs40</button>
                        <button class="quick-sale-btn btn-success" onclick="quickSale(8)" disabled>Chapati Rs35</button>
                    </div>
                    
                    <button class="btn-danger" style="margin-top:20px;" onclick="resetQRSession()">Reset / Next Student</button>
                </div>
            </div>

            <!-- Wallet Recharge -->
            <div id="wallet-recharge" class="sub-section">
                <h3>Wallet Recharge (Admin)</h3>
                <div class="form-card">
                    <form onsubmit="event.preventDefault(); 
                                     const sid = document.getElementById('rechargeStudentId').value; 
                                     const amt = parseFloat(document.getElementById('rechargeAmount').value); 
                                     const mode = document.getElementById('rechargeMode').value; 
                                     if(rechargeWallet(sid, amt, mode)) this.reset();">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Student ID *</label>
                                <input type="text" id="rechargeStudentId" required placeholder="e.g., STU001">
                            </div>
                            <div class="form-group">
                                <label>Amount (Rs) *</label>
                                <input type="number" id="rechargeAmount" min="1" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label>Mode</label>
                                <select id="rechargeMode">
                                    <option value="Cash">Cash</option>
                                    <option value="Online">Online</option>
                                    <option value="Cheque">Cheque</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">Recharge Wallet</button>
                    </form>
                </div>

                <!-- Recharge History -->
                <div class="data-table">
                    <h4>Recent Recharges</h4>
                    <table id="rechargeTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Student ID</th>
                                <th>Student Name</th>
                                <th>Amount (Rs)</th>
                                <th>Mode</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- QR Reports -->
            <div id="qr-reports" class="sub-section">
                <h3>QR Sales Reports</h3>
                <div class="report-filters">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Report Type</label>
                            <select id="qrReportType">
                                <option value="daily-qr">Daily QR Sales</option>
                                <option value="student-expense">Student Expense</option>
                                <option value="low-balance">Low Balance Students</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" id="qrReportDate">
                        </div>
                        <div class="form-group">
                            <button type="button" class="btn-primary" onclick="generateQRReport()">Generate Report</button>
                        </div>
                    </div>
                </div>
                <div class="data-table" id="qrReportDiv">
                    <h4>Report Results</h4>
                    <div id="qrReportContent"></div>
                </div>
            </div>

            <!-- Parent View -->
            <div id="parent-view" class="sub-section">
                <h3>Parent View (Read-Only)</h3>
                <div class="form-card">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Enter Student ID</label>
                            <input type="text" id="parentStudentId" placeholder="e.g., STU001">
                        </div>
                        <div class="form-group">
                            <button type="button" class="btn-primary" onclick="loadParentView()">View Dashboard</button>
                        </div>
                    </div>
                </div>

                <div id="parentDashboard" style="display:none;">
                    <div class="dashboard-grid">
                        <div class="stat-card blue">
                            <h3>Current Balance</h3>
                            <div class="stat-number" id="parentBalance">Rs0</div>
                        </div>
                        <div class="stat-card orange">
                            <h3>Today's Expense</h3>
                            <div class="stat-number" id="parentTodayExpense">Rs0</div>
                        </div>
                        <div class="stat-card green">
                            <h3>Monthly Expense</h3>
                            <div class="stat-number" id="parentMonthlyExpense">Rs0</div>
                        </div>
                        <div class="stat-card red">
                            <h3>Daily Limit</h3>
                            <div class="stat-number" id="parentDailyLimit">Rs0</div>
                        </div>
                    </div>

                    <div class="data-table">
                        <h4>Recent Transactions</h4>
                        <table id="parentTransactionTable">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Item</th>
                                    <th>Amount</th>
                                    <th>Counter</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <div class="data-table">
                        <h4>Recharge History</h4>
                        <table id="parentRechargeTable">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Amount</th>
                                    <th>Mode</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- MESS SECTION (NEW) -->
        <section id="mess" class="section">
            <h2>üçΩÔ∏è Mess Management</h2>
            <p class="section-desc">Student & Staff Mess (Hostel / Day Scholar / Office)</p>
            
            <div class="setup-tabs">
                <button class="tab-btn active" onclick="showSubSection('mess-student-entry')">Student Meal Entry</button>
                <button class="tab-btn" onclick="showSubSection('mess-staff-entry')">Staff Meal Entry</button>
                <button class="tab-btn" onclick="showSubSection('mess-billing')">Billing</button>
                <button class="tab-btn" onclick="showSubSection('mess-reports')">Reports</button>
                <button class="tab-btn" onclick="showSubSection('mess-masters')">Masters</button>
            </div>

            <!-- Student Meal Entry -->
            <div id="mess-student-entry" class="sub-section active">
                <h3>Student Meal Entry (QR Scan)</h3>
                
                <div class="form-card">
                    <h4>Scan Student ID</h4>
                    <input type="text" id="messStudentQR" placeholder="Scan QR or enter Student ID" 
                           style="font-size:20px; padding:15px; width:100%; border:2px solid #667eea; border-radius:8px;"
                           onchange="scanMessStudent(this.value); this.value='';">
                    <p style="margin-top:10px; color:#718096; font-size:14px;">
                        <strong>Test IDs:</strong> MS001, MS002, MS003
                    </p>
                </div>

                <div id="messStudentPanel" style="display:none;" class="form-card">
                    <h4>Student Details</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Student ID:</label>
                            <strong id="messStudentId" style="font-size:18px;">---</strong>
                        </div>
                        <div class="form-group">
                            <label>Name:</label>
                            <strong id="messStudentName" style="font-size:18px;">---</strong>
                        </div>
                        <div class="form-group">
                            <label>Type:</label>
                            <strong id="messStudentType" style="font-size:18px;">---</strong>
                        </div>
                    </div>
                    
                    <h4 style="margin-top:20px;">Mark Meal</h4>
                    <div class="action-buttons">
                        <button class="quick-sale-btn btn-success" onclick="markStudentMeal('Breakfast')" disabled>Breakfast</button>
                        <button class="quick-sale-btn btn-success" onclick="markStudentMeal('Lunch')" disabled>Lunch</button>
                        <button class="quick-sale-btn btn-success" onclick="markStudentMeal('Dinner')" disabled>Dinner</button>
                    </div>
                    
                    <button class="btn-danger" style="margin-top:20px;" onclick="resetMessSession()">Reset / Next</button>
                </div>
            </div>

            <!-- Staff Meal Entry -->
            <div id="mess-staff-entry" class="sub-section">
                <h3>Staff Meal Entry</h3>
                
                <div class="form-card">
                    <h4>Enter Staff ID</h4>
                    <input type="text" id="messStaffId" placeholder="Enter Staff ID" 
                           style="font-size:20px; padding:15px; width:100%; border:2px solid #667eea; border-radius:8px;"
                           onchange="scanMessStaff(this.value); this.value='';">
                    <p style="margin-top:10px; color:#718096; font-size:14px;">
                        <strong>Test IDs:</strong> STF001, STF002, STF003
                    </p>
                </div>

                <div id="messStaffPanel" style="display:none;" class="form-card">
                    <h4>Staff Details</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Staff ID:</label>
                            <strong id="messStaffIdDisplay" style="font-size:18px;">---</strong>
                        </div>
                        <div class="form-group">
                            <label>Name:</label>
                            <strong id="messStaffName" style="font-size:18px;">---</strong>
                        </div>
                        <div class="form-group">
                            <label>Meal Allowed:</label>
                            <strong id="messStaffAllowed" style="font-size:18px;">---</strong>
                        </div>
                    </div>
                    
                    <h4 style="margin-top:20px;">Mark Meal</h4>
                    <div class="action-buttons">
                        <button class="quick-sale-btn btn-success" onclick="markStaffMeal('Breakfast')" disabled>Breakfast</button>
                        <button class="quick-sale-btn btn-success" onclick="markStaffMeal('Lunch')" disabled>Lunch</button>
                        <button class="quick-sale-btn btn-success" onclick="markStaffMeal('Dinner')" disabled>Dinner</button>
                    </div>
                    
                    <button class="btn-danger" style="margin-top:20px;" onclick="resetMessSession()">Reset / Next</button>
                </div>
            </div>

            <!-- Billing -->
            <div id="mess-billing" class="sub-section">
                <h3>Generate Monthly Bills</h3>
                
                <div class="form-card">
                    <form onsubmit="event.preventDefault(); generateMessBills();">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Month *</label>
                                <input type="month" id="messBillMonth" required>
                            </div>
                            <div class="form-group">
                                <label>Bill Type *</label>
                                <select id="messBillType" required>
                                    <option value="student">Student Bills</option>
                                    <option value="staff">Staff Bills</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">Generate Bills</button>
                    </form>
                </div>

                <div class="data-table" id="messBillDiv">
                    <h4>Generated Bills</h4>
                    <div id="messBillContent"></div>
                </div>
            </div>

            <!-- Reports -->
            <div id="mess-reports" class="sub-section">
                <h3>Mess Reports</h3>
                
                <div class="report-filters">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Report Type</label>
                            <select id="messReportType">
                                <option value="daily">Daily Meal Report</option>
                                <option value="student-monthly">Student Monthly</option>
                                <option value="staff-monthly">Staff Monthly</option>
                                <option value="summary">Monthly Summary</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Date/Month</label>
                            <input type="text" id="messReportDate" placeholder="YYYY-MM-DD or YYYY-MM">
                        </div>
                        <div class="form-group">
                            <button type="button" class="btn-primary" onclick="generateMessReport()">Generate Report</button>
                        </div>
                    </div>
                </div>
                
                <div class="data-table" id="messReportDiv">
                    <h4>Report Results</h4>
                    <div id="messReportContent"></div>
                </div>
            </div>

            <!-- Masters -->
            <div id="mess-masters" class="sub-section">
                <h3>Mess Masters</h3>
                
                <div class="form-card">
                    <h4>Add Mess Student</h4>
                    <form id="messStudentForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Student ID *</label>
                                <input type="text" id="newMessStudentId" required>
                            </div>
                            <div class="form-group">
                                <label>Name *</label>
                                <input type="text" id="newMessStudentName" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Student Type *</label>
                                <select id="newMessStudentType" required>
                                    <option value="Hostel">Hostel</option>
                                    <option value="Day Scholar">Day Scholar</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Monthly Fee (Rs) *</label>
                                <input type="number" id="newMessStudentFee" required min="0">
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">Save Student</button>
                    </form>
                </div>

                <div class="data-table">
                    <h4>Mess Students</h4>
                    <table id="messStudentsTable">
                        <thead>
                            <tr>
                                <th>Student ID</th>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Monthly Fee</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- REPORTS SECTION -->
        <section id="reports" class="section">
            <h2>üìà Stock & Expense Reports</h2>
            <p class="section-desc">Inventory management and expense tracking</p>
            
            <div class="setup-tabs">
                <button class="tab-btn active" onclick="showSubSection('stock')">Stock Management</button>
                <button class="tab-btn" onclick="showSubSection('expenses')">Expenses</button>
                <button class="tab-btn" onclick="showSubSection('combined-reports')">Combined Reports</button>
            </div>

            <!-- Stock Management -->
            <div id="stock" class="sub-section active">
                <h3>10. Stock Management</h3>
                <div class="form-card">
                    <form id="stockForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Date *</label>
                                <input type="date" id="stockDate" required>
                            </div>
                            <div class="form-group">
                                <label>Food Item *</label>
                                <select id="stockItem" required>
                                    <option value="">Select Item</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Opening Stock</label>
                                <input type="number" id="stockOpening" min="0" value="0" readonly>
                            </div>
                            <div class="form-group">
                                <label>Purchase Quantity *</label>
                                <input type="number" id="stockPurchase" required min="0" value="0">
                            </div>
                        </div>
                        <div class="alert-info">
                            <strong>Note:</strong> Stock is automatically deducted when:
                            <ul>
                                <li>Diwa Khaja food is distributed</li>
                                <li>Canteen sale is made</li>
                            </ul>
                            Closing Stock = Opening + Purchase - (Diwa Khaja + Canteen Sales)
                        </div>
                        <button type="submit" class="btn-primary">Update Stock</button>
                    </form>
                </div>
                <div class="data-table">
                    <h4>Current Stock Status</h4>
                    <table id="stockTable">
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Opening</th>
                                <th>Purchase</th>
                                <th>Diwa Khaja Used</th>
                                <th>Canteen Sold</th>
                                <th>Closing Stock</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Expenses -->
            <div id="expenses" class="sub-section">
                <h3>11. Expense Management</h3>
                <div class="form-card">
                    <form id="expenseForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Date *</label>
                                <input type="date" id="expenseDate" required>
                            </div>
                            <div class="form-group">
                                <label>Expense Name *</label>
                                <select id="expenseName" required>
                                    <option value="">Select Expense Type</option>
                                    <option value="Gas">Gas</option>
                                    <option value="Vegetables">Vegetables</option>
                                    <option value="Groceries">Groceries</option>
                                    <option value="Transport">Transport</option>
                                    <option value="Salary">Salary</option>
                                    <option value="Electricity">Electricity</option>
                                    <option value="Water">Water</option>
                                    <option value="Maintenance">Maintenance</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Amount (Rs) *</label>
                                <input type="number" id="expenseAmount" required min="0" step="0.01">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="expenseDesc" rows="2" placeholder="Additional details"></textarea>
                        </div>
                        <button type="submit" class="btn-primary">Save Expense</button>
                    </form>
                </div>
                <div class="data-table">
                    <h4>Recent Expenses</h4>
                    <table id="expenseTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Expense Type</th>
                                <th>Amount (Rs)</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Combined Reports -->
            <div id="combined-reports" class="sub-section">
                <h3>12. Stock & Expense Reports</h3>
                <div class="report-filters">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Report Type</label>
                            <select id="combinedReportType">
                                <option value="stock-summary">Stock Summary</option>
                                <option value="expense-summary">Expense Summary</option>
                                <option value="profit-loss">Profit & Loss</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>From Date</label>
                            <input type="date" id="reportFromDate">
                        </div>
                        <div class="form-group">
                            <label>To Date</label>
                            <input type="date" id="reportToDate">
                        </div>
                        <div class="form-group">
                            <button type="button" class="btn-primary" onclick="generateCombinedReport()">Generate Report</button>
                        </div>
                    </div>
                </div>
                <div class="data-table" id="combinedReportDiv">
                    <h4>Report Results</h4>
                    <div id="combinedReportContent"></div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; School Canteen Management System | Design By Swapneel Singh Thakuri </p>
        </div>
    </footer>

    <script src="app.js"></script>
</body>
</html>
